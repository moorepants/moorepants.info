<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Fixin' photo timestamps | moorepants
</title>
  <link rel="canonical" href="https://moorepants.github.io/moorepants.info/blog/photo-dates.html">


  <link rel="stylesheet" href="https://moorepants.github.io/moorepants.info/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/moorepants.info/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/moorepants.info/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://moorepants.github.io/moorepants.info/theme/css/theme.css">
  <link rel="stylesheet" href="https://moorepants.github.io/moorepants.info/theme/css/origtheme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://moorepants.github.io/moorepants.info/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://moorepants.github.io/moorepants.info/feeds/misc.atom.xml">  
  <meta name="description" content="Yumi and I just got back from a month long bicycle tour of Japan. We took two cameras with us. My Panasonic Lumix stopped autofocusing the first day of the trip, so we used her Canon Powershot for all the photographing. We dropped the Canon twice on the trip and â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://moorepants.github.io/moorepants.info/">
        <img class="img-fluid rounded" src=https://objects-us-east-1.dream.io/moorepants/headshot.jpg alt="moorepants">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://moorepants.github.io/moorepants.info/">moorepants</a></h1>
      <p class="text-muted">a websitee</p>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/about.html">About</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/portfolio.html">Portfolio</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/interests.html">Interests</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/research.html">Research</a></li>
            <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/teaching.html">Teaching</a></li>
          <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/blog/">Blog</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Fixin' photo timestamps
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2013-05-26T02:10:00-07:00">
          <i class="fas fa-clock"></i>
          Sun 26 May 2013
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="https://moorepants.github.io/moorepants.info/category/misc.html">misc</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-user"></i>
              <a href="https://moorepants.github.io/moorepants.info/author/jason-k-moore.html">Jason K. Moore</a>          </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="https://moorepants.github.io/moorepants.info/tag/photo.html">#photo</a>,               <a href="https://moorepants.github.io/moorepants.info/tag/python.html">#python</a>,               <a href="https://moorepants.github.io/moorepants.info/tag/timestamp.html">#timestamp</a>,               <a href="https://moorepants.github.io/moorepants.info/tag/gexiv2.html">#gexiv2</a>,               <a href="https://moorepants.github.io/moorepants.info/tag/pytz.html">#pytz</a>          </li>
      </ul>
    </header>


    <div class="content">
      <p>Yumi and I just got back from a month long bicycle tour of Japan. We took two
cameras with us. My Panasonic Lumix stopped autofocusing the first day of the
trip, so we used her Canon Powershot for all the photographing. We dropped the
Canon twice on the trip and now it makes a nasty noise when opening and
closing, but it at least still takes photos.</p>
<p>We forgot to set the travel time on the camera so all 700+ of our photos had
timestamps from Pacific Standard Time while under daylight saving time (Japan
does not use DST). I wanted to correct the timestamps before uploading them to
the web so I wrote a little Python script and used <a class="reference external" href="http://www.yorba.org">Yorba</a>'s <a class="reference external" href="http://redmine.yorba.org/projects/gexiv2/wiki">Gexiv2</a> and the
<a class="reference external" href="http://pytz.sourceforge.net">PyTZ</a> package to sort things out.</p>
<p>To install Gexiv2 in Ubuntu 12.10 I ran these commands:</p>
<pre class="literal-block">
$ sudo aptitude install libexiv2-dev libtool libgirepository1.0-dev
$ git clone git://git.yorba.org/gexiv2
$ cd gexiv2
$ ./configure --enable-introspection
$ make
$ sudo make install
</pre>
<p>And installed PyTZ with pip:</p>
<pre class="literal-block">
$ sudo pip install pytz
</pre>
<p>Then I wrote this script which searched my photo directory for the specific
folders and photographs and adjusted the three timestamps in the photos (this
didn't work with the few .mov files we took during the trip because Gexiv2
doesn't support <tt class="docutils literal">.mov</tt> files, so that will need to be done manually or I need
to find another tool):</p>
<pre class="literal-block">
#!/usr/bin/env python
# -*- coding: utf-8 -*-

&quot;&quot;&quot;This script converts the time/date stamp of photographs we took in Japan
to Japanese time/date from US Pacific time because we forgot to adjust the
camera's internal clock at the beginning of the trip.&quot;&quot;&quot;

import os
import re
from datetime import datetime

import pytz
from gi.repository import GExiv2

# The Canon PowerShot SX200 IS date format.
DATE_FORMAT = '%Y:%m:%d %H:%M:%S'

# We snapped photos in Japan while using the current PST time (which is under
# Daylight Savings Time, but Japan is not).
pacific_tz = pytz.timezone(&quot;America/Los_Angeles&quot;)
japan_tz = pytz.timezone(&quot;Asia/Tokyo&quot;)

# Get a list of file names that match the time we were there and the camera
# filename format.
directory = &quot;/media/Data/My Pictures&quot;
pattern = r&quot;/media/Data/My Pictures/2013-0[4-5]-\d\d/img_\d\d\d\d.jpg&quot;

files_to_adjust = []

for root, dirnames, filenames in os.walk(directory):
    for filename in filenames:
        path = os.path.join(root, filename)
        result = re.match(pattern, path)
        # if a matching file is found, save it to the list
        if result:
            files_to_adjust.append(path)

# Now adjust the three timestamps (DateTime, DateTimeDigitized and
# DateTimeOriginal) for each file and save the results.

for filename in files_to_adjust:

    print('-' * 20)
    print(filename)
    print('-' * 20)

    metadata = GExiv2.Metadata(filename)

    for tag in metadata.get_exif_tags():
        if 'DateTime' in tag:
            timestamp = metadata[tag]
            pacific_time = pacific_tz.localize(datetime.strptime(timestamp,
                DATE_FORMAT))
            japan_time = pacific_time.astimezone(japan_tz)
            japan_timestamp = japan_time.strftime(DATE_FORMAT)
            print(tag)
            print('Current time stamp: {}.'.format(timestamp))
            print('Adjusted time stamp: {}.'.format(japan_timestamp))
            print('-' * 20)

            # Set the timestamp.
            metadata[tag] = japan_timestamp

    # Save the file with the adjusted timestamps.
    metadata.save_file()
</pre>
<p>The resulting output for an example file looked like this:</p>
<pre class="literal-block">
--------------------
/media/Data/My Pictures/2013-05-21/img_5484.jpg
--------------------
Exif.Image.DateTime
Current time stamp: 2013:05:21 00:51:31.
Adjusted time stamp: 2013:05:21 16:51:31.
--------------------
Exif.Photo.DateTimeDigitized
Current time stamp: 2013:05:21 00:51:31.
Adjusted time stamp: 2013:05:21 16:51:31.
--------------------
Exif.Photo.DateTimeOriginal
Current time stamp: 2013:05:21 00:51:31.
Adjusted time stamp: 2013:05:21 16:51:31.
--------------------
</pre>
<p>The correct 16 hour difference was applied correctly by PyTZ which takes care
of DST differences. I then had to remove all of the photos from my Shotwell
library and re-add them because the Shotwell database didn't automatically
update with the new times. Once I did that, everything was now correct (except
the <tt class="docutils literal">.mov</tt> files, of course).</p>
<p>The <a class="reference external" href="https://plus.google.com/photos/110966557175293116547/albums/5882019377214495409">photos of the trip</a> can be found in my G+ photo album.</p>

    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://moorepants.github.io/moorepants.info/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>
<div class="row">
  <div class="col-sm-4 mx-auto text-center text-muted" >
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
  </div>
</div>    </div>
  </footer>

</body>

</html>